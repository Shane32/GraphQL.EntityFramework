<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /doco/mdsource/id-type-rename.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Id type rename

In version 5, the `Id` type changed from `String` to `ID`. For queries that use named variables, this can cause type validations errors if the client and server are out of sync.

For example:

A version 4 query would look like this:

```graphql
query ($id: String!)
{
  MyEntities(id:$id)
  {
    id
  }
}
```
A version 5 query would look like this:

```graphql
query ($id: ID!)
{
  MyEntities(id:$id)
  {
    id
  }
}
```

Using the version 4 query against a version 5 server would result in:

```
Variable "$id" of type "String!" used in position expecting type "ID".
```

To work around this it is necessary to use a [ValidationRule](https://graphql-dotnet.github.io/docs/getting-started/query-validation) to change the variable type. There is an included ValidationRule included that achieves this:

<!-- snippet: FixIdTypeRule.cs -->
```cs
using System.Collections.Generic;
using System.Linq;
using GraphQL.Language.AST;
using GraphQL.Types;
using GraphQL.Validation;

namespace GraphQL.EntityFramework
{
    //when executing a query with a variable against an ID field, typically you must
    //  define the variable type as ID or else graphql will throw an exception
    //this patch will automatically change a variable's data type from string to ID
    //  in this situation.  this allows you to skip defining the variable's data type
    //  for ID fields
    public class FixIdTypeRule :
        IValidationRule
    {
        static List<IValidationRule> validationRules;
        static NonNullType idNode = new NonNullType(new NamedType(new NameNode("ID")));

        static FixIdTypeRule()
        {
            //initialize a static field in case anyone wants to use it without creating a list
            validationRules = DocumentValidator.CoreRules();
            validationRules.Insert(0, new FixIdTypeRule());
        }

        public INodeVisitor Validate(ValidationContext context)
        {
            Dictionary<string, List<VariableUsage>> variableUsages = null;

            return new EnterLeaveListener(
                listener =>
                {
                    listener.Match<VariableDefinition>(
                        variableDefinition =>
                        {
                            var variableUsageValues = variableUsages[variableDefinition.Name];
                            foreach (var variableUsage in variableUsageValues)
                            {
                                if (variableUsage.Type is IdGraphType &&
                                    variableDefinition.Type is NonNullType nonNullType &&
                                    nonNullType.Type is NamedType namedType &&
                                    namedType.Name == "String")
                                {
                                    variableDefinition.Type = idNode;
                                }
                            }
                        });

                    listener.Match<Operation>(
                        operation =>
                        {
                            variableUsages = context.GetRecursiveVariables(operation).GroupBy(o => o.Node.Name)
                                    .ToDictionary(g => g.Key, g => g.ToList());
                        }
                    );
                });
        }

        public static IEnumerable<IValidationRule> CoreRulesWithIdFix => validationRules;
    }
}
```
<sup>[snippet source](/src/GraphQL.EntityFramework/IdPatch/FixIdTypeRule.cs#L1-L62)</sup>
<!-- endsnippet -->

To use this rule set `ExecutionOptions.ValidationRules` to `FixIdTypeRule.CoreRulesWithIdFix`:

<!-- snippet: ExecutionOptionsWithFixIdTypeRule -->
```cs
var executionOptions = new ExecutionOptions
{
    Schema = schema,
    Query = query,
    UserContext = dbContext,
    Inputs = inputs,
    ValidationRules = FixIdTypeRule.CoreRulesWithIdFix
};
```
<sup>[snippet source](/src/Tests/IntegrationTests/QueryExecutor.cs#L29-L38)</sup>
<!-- endsnippet -->
